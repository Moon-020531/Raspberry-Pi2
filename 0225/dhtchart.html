<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="CACHE-CONTROL" content="NO-CACHE" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>실시간 온도, 습도 측정기</title>
    
    <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highcharts/4.0.4/highcharts.js"></script>
    
    <script>
        var chart;   
        var chart2;  
        var pollUri = "/events";

        function pollEvent() {
            $.getJSON(pollUri, function(data) {
                var t = new Date();
                t.setHours(t.getHours() + 9); 
                
                if(data && data.temperature && data.humidity) {
                    charAddPoint([t.getTime(), Number(data.temperature)]);
                    charAddPoint2([t.getTime(), Number(data.humidity)]);
                }
            });
            setTimeout(pollEvent, 5000);
        }

        function charAddPoint(tval) {
            var series = chart.series[0];
            var shift = series.data.length > 20; 
            chart.series[0].addPoint(tval, true, shift); 
        }

        function charAddPoint2(tval) {
            var series = chart2.series[0];
            var shift2 = series.data.length > 20; 
            chart2.series[0].addPoint(tval, true, shift2); 
        }

        $(function() {
            chart = new Highcharts.Chart({
                chart:  {renderTo: 'temp', defaultSeriesType: 'spline'},
                title:  {text: '실시간 온도 데이터'},
                xAxis:  {type: 'datetime', tickPixelInterval: 120, maxZoom: 20 * 1000},
                yAxis:  {minPadding: 0.2, maxPadding: 0.2, title: {text: '온도(C)', margin: 20}},
                series: [{name: '온도', data: []}]
            }); 

            chart2 = new Highcharts.Chart({
                chart:  {renderTo: 'humi', defaultSeriesType: 'spline'},
                title:  {text: '실시간 습도 데이터'},
                xAxis:  {type: 'datetime', tickPixelInterval: 120, maxZoom: 20 * 1000},
                yAxis:  {minPadding: 0.2, maxPadding: 0.2, title: {text: '습도(%)', margin: 20}},
                series: [{name: '습도', data: []}]
            });

            pollEvent(); 
        });    
    </script>
</head>
<body>
    <div id="temp" style="width:100%; height:300px; margin-bottom: 20px;"></div>
    <div id="humi" style="width:100%; height:300px;"></div>
</body>
</html>